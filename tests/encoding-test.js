// var crypto = require('crypto');
// const fs = require('fs');
//
// // Harish test skill
// var primaryKey = 'WZRd7N843lHJHpLesU8c3upBWZOCofSu';
// var secondaryKey = '5jBRCVh9xiNzrg0Sz0fiWaNWQK56svm6';
// var payload = '{"type":"skill_invocation","skill":{"id":"6361","type":"skill","name":"Harish Test Skill","api_key":"cu0gb6u83dcac0ygj6axveopzz03faj9"},"token":{"read":{"access_token":"1!TL-oRUtvWQxs6BxLeQCJdJXjsbJ4QMGiRGqNFleW8MpjMP9nTx6wpFDSiVB4EI9qBb0VDYNtEyy1W45Fx6FXg5agnqdd3nYSYdopz5990LmFiTLzk3sFvvqyYO_81jvBpvt8m4RvzI-ai2lwtPx3Ta6eYLlD4KUvqMP0DL3Xzzc8USi713t30C16JZzHGlkR6r52huennszIUU7gw4BGv16NHeQLnTY_ekPF7be6fTH9D3r2lueW1CoRWUYf07TepjIg257h4xkzpNdzbZW9V70YBPpt0dL7Hr6h3ikQUeFRM1TbGKDFCZ7On18iYpTlcpqaYxeyy9ZTlKBgpfqBeWYC5a6HfibrxBKNwxbxmQzgnztCyRQL7DUjqn7wLstTNI0meqoRwZeXpKj-2dYe8bSF34lOzUg3n3Moj2WKU8BzlvbfKQ..","expires_in":1598985592,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_read\\",\\"object_id\\":713932236213,\\"object_type\\":\\"file\\"}]","token_type":"bearer"},"write":{"access_token":"1!DqheilbLdCSUeNopYGKFvBF9FzAMzeHu5u0X1lD7i9BWz659QLyFjU7q-Vvwowy6blrmC2OyRsg3N9rcwJIHCBAZA-B7qcCo-UMUvOrCfSisQn7l57NWOWGj0JzsU0zBkthKXsc0ebXq4q_h35A_ygh8fOz9_lMyhzXqDiXEZ_rIm9KUgPV187fP5a_RU8FL--wG_LTSzcj2ikGd8UNasi2OUUEzuDd3AUStJZulymtofIlldirTYjl94WPeth2kjASioHpCBiYg_6JRXfaXSqjDiTMFMuNyztL0UT7T_krxXiFm73SWKMcQtUzfjfwE9UdmU8K1E7R2250MazVpzv3mXl3ZHRUqIrLByAi0DeOtmK4lC0LZOmgYJ-jnH3e-4cvhHxljgud2tCe6FIITJzys3YKIH4Bndoq-dVZHF6UeIDgHxQMPKM8R66xMLCNqYjzvrcr3l4TSiJlXDzsyRY64-b23ti41b4Djv_P0jUQ.","expires_in":1598985592,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_upload\\",\\"object_id\\":713932236213,\\"object_type\\":\\"file\\"},{\\"scope\\":\\"manage_skill_invocations\\"}]","token_type":"bearer"}},"status":{"state":"invoked","message":"","error_code":"","additional_info":""},"skill_rules":[{"id":"1506254","type":"skill_rule","config":"{\\"channel_id\\":\\"\\"}"}],"id":"d4b7c613-0c00-4222-8876-b2ffff159b21_46924361","created_at":"2020-08-31T11:39:52-07:00","trigger":"FILE_CONTENT","enterprise":{"type":"enterprise","id":"13483228","name":"Box"},"source":{"type":"file","id":"713932236213","name":"20200824_202302.jpg","sequence_id":"0","file_version":{"id":"758767988613"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""},"size":292960},"event":{"event_id":"d4b7c613-0c00-4222-8876-b2ffff159b21","event_type":"ITEM_UPLOAD","created_at":"2020-08-31T11:39:52-07:00","created_by":{"type":"user","id":"238120843","name":"Harish Gokavarapu","login":"mail.iamharish@gmail.com"},"source":{"type":"file","id":"713932236213","name":"20200824_202302.jpg","sequence_id":"0","file_version":{"id":"758767988613"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""}},"skill_rule":{"id":"*"}},"parameters":{}}';
// var timestamp = '2020-08-31T11:39:52-07:00';
//
// // japanese unicoded
// payload = '{"type":"skill_invocation","skill":{"id":"6361","type":"skill","name":"Harish Test Skill","api_key":"cu0gb6u83dcac0ygj6axveopzz03faj9"},"token":{"read":{"access_token":"1!iAlwUPfxcMMbIXEAHbEc2jnW6l9GMnZQa8JWFe3j24jGcBftl8YYSwlFXGRwCRGoCfeTJZZeJ7QTLwVLR8kOBLq-ktBfD4466_yU8x5Seux238SEwhTCSupwXuzGTPSNOL1pmr-GOz3Tg7kvVAIbcn_WcjbMQv2MXFw8oXHypoC5t5gcIrLo91DQTE8i67xpiZStVL8WIqtL3eosG7u8VDlnAcR-BtzDg8X2Uha5fnSO-GsGIn-R3axzV0NE47LPoViEkLdctM1Ada-L2R3unJp5H5bD2TskxnhOzPHEKdH3LGZ6ycyUAxpxsr_JDU-Ti5XyNLuIXN0laxAsRFOqwJLCmOAVVfIp9X-p56hpr9q1Yw6k0B_yxnGEl_0lEdCTxjZEN7k0iPNq7xd8VrdhuOxt-V06eaLkY-wJGorKexOdnoYl2Q..","expires_in":1598984928,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_read\\",\\"object_id\\":713927876346,\\"object_type\\":\\"file\\"}]","token_type":"bearer"},"write":{"access_token":"1!SOBj41mGPuQB1JSNTQL3VmhRCyWUPJlDWn0lJcVAW_v9Bh7mGfEqyFLo_ew2Zqn8R_QTWeMDH2s2hjXFqtRKKWEe-nq82nMo3HvNSFsSdZdBHQKkbn1fSnXI0HupSc_5z-Vnl0a7bcITBVgFRBk8MrkHTz_MtEhcoDoaRGtM_qLOnuaw9IvxChTzKIbEmZx7LIdj7B_z9Cj1WWi1-OZWzOvXHH7GSe7GVFnzX0_P1mpS5SnaiRS5msoAfb8MsxOqFGc5HVvMF0utn4ckLEu_P0zXajby61H9RZb4zx6uPOPVsphRbB-OwDWfvwr472BsuQI_6I46hgUaYlrOEAyC0cvdnjZozT1Oz7y0kHsu7ItjdvktWmA73D2IFeG13nyfRrkFlvNUKRJTHSKI1Pxq9G5VrWwTlAavluZp4vLwzjehoQuhLkhf8a4OCnUSVmf2PQBAeDYQy1fcDMJZjMLXseJk4lHfZI4pmDj0hBy5X9g.","expires_in":1598984928,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_upload\\",\\"object_id\\":713927876346,\\"object_type\\":\\"file\\"},{\\"scope\\":\\"manage_skill_invocations\\"}]","token_type":"bearer"}},"status":{"state":"invoked","message":"","error_code":"","additional_info":""},"skill_rules":[{"id":"1506254","type":"skill_rule","config":"{\\"channel_id\\":\\"\\"}"}],"id":"bce71bf9-e3e5-4dc8-b1e7-7d09949769a0_394499812","created_at":"2020-08-31T11:28:48-07:00","trigger":"FILE_CONTENT","enterprise":{"type":"enterprise","id":"13483228","name":"Box"},"source":{"type":"file","id":"713927876346","name":"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-08-05 9.21.29.txt","sequence_id":"0","file_version":{"id":"758762997546"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""},"size":46},"event":{"event_id":"bce71bf9-e3e5-4dc8-b1e7-7d09949769a0","event_type":"ITEM_UPLOAD","created_at":"2020-08-31T11:28:48-07:00","created_by":{"type":"user","id":"238120843","name":"Harish Gokavarapu","login":"mail.iamharish@gmail.com"},"source":{"type":"file","id":"713927876346","name":"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-08-05 9.21.29.txt","sequence_id":"0","file_version":{"id":"758762997546"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""}},"skill_rule":{"id":"*"}},"parameters":{}}';
// // actual japanese text
// // payload = '{"type":"skill_invocation","skill":{"id":"6361","type":"skill","name":"Harish Test Skill","api_key":"cu0gb6u83dcac0ygj6axveopzz03faj9"},"token":{"read":{"access_token":"1!iAlwUPfxcMMbIXEAHbEc2jnW6l9GMnZQa8JWFe3j24jGcBftl8YYSwlFXGRwCRGoCfeTJZZeJ7QTLwVLR8kOBLq-ktBfD4466_yU8x5Seux238SEwhTCSupwXuzGTPSNOL1pmr-GOz3Tg7kvVAIbcn_WcjbMQv2MXFw8oXHypoC5t5gcIrLo91DQTE8i67xpiZStVL8WIqtL3eosG7u8VDlnAcR-BtzDg8X2Uha5fnSO-GsGIn-R3axzV0NE47LPoViEkLdctM1Ada-L2R3unJp5H5bD2TskxnhOzPHEKdH3LGZ6ycyUAxpxsr_JDU-Ti5XyNLuIXN0laxAsRFOqwJLCmOAVVfIp9X-p56hpr9q1Yw6k0B_yxnGEl_0lEdCTxjZEN7k0iPNq7xd8VrdhuOxt-V06eaLkY-wJGorKexOdnoYl2Q..","expires_in":1598984928,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_read\\",\\"object_id\\":713927876346,\\"object_type\\":\\"file\\"}]","token_type":"bearer"},"write":{"access_token":"1!SOBj41mGPuQB1JSNTQL3VmhRCyWUPJlDWn0lJcVAW_v9Bh7mGfEqyFLo_ew2Zqn8R_QTWeMDH2s2hjXFqtRKKWEe-nq82nMo3HvNSFsSdZdBHQKkbn1fSnXI0HupSc_5z-Vnl0a7bcITBVgFRBk8MrkHTz_MtEhcoDoaRGtM_qLOnuaw9IvxChTzKIbEmZx7LIdj7B_z9Cj1WWi1-OZWzOvXHH7GSe7GVFnzX0_P1mpS5SnaiRS5msoAfb8MsxOqFGc5HVvMF0utn4ckLEu_P0zXajby61H9RZb4zx6uPOPVsphRbB-OwDWfvwr472BsuQI_6I46hgUaYlrOEAyC0cvdnjZozT1Oz7y0kHsu7ItjdvktWmA73D2IFeG13nyfRrkFlvNUKRJTHSKI1Pxq9G5VrWwTlAavluZp4vLwzjehoQuhLkhf8a4OCnUSVmf2PQBAeDYQy1fcDMJZjMLXseJk4lHfZI4pmDj0hBy5X9g.","expires_in":1598984928,"restricted_to":"[{\\"scope\\":\\"gcm\\"},{\\"scope\\":\\"item_upload\\",\\"object_id\\":713927876346,\\"object_type\\":\\"file\\"},{\\"scope\\":\\"manage_skill_invocations\\"}]","token_type":"bearer"}},"status":{"state":"invoked","message":"","error_code":"","additional_info":""},"skill_rules":[{"id":"1506254","type":"skill_rule","config":"{\\"channel_id\\":\\"\\"}"}],"id":"bce71bf9-e3e5-4dc8-b1e7-7d09949769a0_394499812","created_at":"2020-08-31T11:28:48-07:00","trigger":"FILE_CONTENT","enterprise":{"type":"enterprise","id":"13483228","name":"Box"},"source":{"type":"file","id":"713927876346","name":"スクリーンショット 2020-08-05 9.21.29.txt","sequence_id":"0","file_version":{"id":"758762997546"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""},"size":46},"event":{"event_id":"bce71bf9-e3e5-4dc8-b1e7-7d09949769a0","event_type":"ITEM_UPLOAD","created_at":"2020-08-31T11:28:48-07:00","created_by":{"type":"user","id":"238120843","name":"Harish Gokavarapu","login":"mail.iamharish@gmail.com"},"source":{"type":"file","id":"713927876346","name":"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2020-08-05 9.21.29.txt","sequence_id":"0","file_version":{"id":"758762997546"},"owner_enterprise_id":"13483228","parent":{"id":"47751663067"},"old_parent_id":"","collab_accessible_by":{"type":"","id":"","name":"","login":""}},"skill_rule":{"id":"*"}},"parameters":{}}';
// payload = fs.readFileSync('./payload.txt', {encoding: 'utf8'});
// // japanese
// timestamp = '2020-08-31T11:28:49-07:00';
// var signature1 = 'mHsiiomholWgVnvOrY3GrHNZNyaGqSlwU2fh5comYSY=';
// var signature2 = '9tL2RXYGw0agnezuhCJmpXOTLmqYaPUqjNFV1S+n0Mo=';
//
// // payload = payload.replace(/\//g, '\\/');
// console.log(payload);
// console.log(payload.length);
// var date = Date.parse(timestamp);
// var hmac1 = crypto.createHmac('sha256', primaryKey);
// hmac1.update(payload);
// hmac1.update(timestamp);
// var hmac2 = crypto.createHmac('sha256', secondaryKey);
// hmac2.update(payload);
// hmac2.update(timestamp);
// var digest1 = hmac1.digest('base64');
// var digest2 = hmac2.digest('base64');
// console.log(digest1);
// console.log(digest2);
// var primarySignatureValid = digest1 === signature1;
// var secondarySignatureValid = digest2 === signature2;
// var valid = (primarySignatureValid || secondarySignatureValid);
// console.log(valid);
